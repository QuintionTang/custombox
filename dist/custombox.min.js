/*
 *  custombox - Modal dialog effects with transitions CSS3
 *  version: 4.0.5
 *  http://dixso.github.io/custombox/
 *  (c) 2020 Julio de la Calle - @dixso9
 *
 *  Under MIT License - http://opensource.org/licenses/MIT
 */
"use strict";var Custombox,_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}!function(Custombox){var CB="custombox",OPEN=CB+"-open",CLOSE=CB+"-close",LOCK=CB+"-lock",FROM="animateFrom",positionValues=["top","right","bottom","left"],animationValues=["slide","blur","flip","rotate","letmein","makeway","slip","corner","slidetogether","push","contentscale"],containerValues=["blur","makeway","slip","push","contentscale"],overlayValues=["letmein","makeway","slip","corner","slidetogether","door","push","contentscale"],together=["corner","slidetogether","scale","door","push","contentscale"],perspective=["fall","sidefall","flip","sign","slit","letmein","makeway","slip"],Snippet=function(){function Snippet(){_classCallCheck(this,Snippet)}return _createClass(Snippet,null,[{key:"check",value:function(values,match){return-1<values.indexOf(match)}},{key:"isIE",value:function(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");if(0<msie)return!isNaN(parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10));if(0<ua.indexOf("Trident/")){var rv=ua.indexOf("rv:");return!isNaN(parseInt(ua.substring(rv+3,ua.indexOf(".",rv)),10))}var edge=ua.indexOf("Edge/");return 0<edge&&!isNaN(parseInt(ua.substring(edge+5,ua.indexOf(".",edge)),10))}}]),Snippet}(),Scroll=function(){function Scroll(){_classCallCheck(this,Scroll),this.position=document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop||0,document.documentElement.classList.add(CB+"-perspective")}return _createClass(Scroll,[{key:"remove",value:function(){document.documentElement.classList.remove(CB+"-perspective"),window.scrollTo(0,this.position)}}]),Scroll}(),DefaultSchema=function DefaultSchema(){_classCallCheck(this,DefaultSchema),this.overlay={color:"#000",opacity:.48,close:!0,speedIn:300,speedOut:300,onOpen:null,onComplete:null,onClose:null,zIndex:9997,active:!0},this.content={id:null,target:null,container:null,clone:!1,animateFrom:"top",animateTo:"top",positionX:"center",positionY:"center",width:null,effect:"fadein",speedIn:300,speedOut:300,delay:150,fullscreen:!1,onOpen:null,onComplete:null,onClose:null,close:!0},this.loader={active:!0,color:"#FFF",background:"#999",speed:1e3}},Options=function(_DefaultSchema){function Options(options){_classCallCheck(this,Options);var _this=_possibleConstructorReturn(this,(Options.__proto__||Object.getPrototypeOf(Options)).call(this));return Object.keys(_this).forEach(function(key){options[key]&&_extends(_this[key],options[key])}),_this}return _inherits(Options,DefaultSchema),Options}(),Loader=function(){function Loader(options){_classCallCheck(this,Loader),this.options=options,this.element=document.createElement("div"),this.element.classList.add(CB+"-loader"),this.element.style.borderColor=this.options.loader.background,this.element.style.borderTopColor=this.options.loader.color,this.element.style.animationDuration=this.options.loader.speed+"ms",document.body.appendChild(this.element)}return _createClass(Loader,[{key:"show",value:function(){this.element.style.display="block"}},{key:"destroy",value:function(){this.element.parentElement.removeChild(this.element)}}]),Loader}(),Container=function(){function Container(options){if(_classCallCheck(this,Container),this.options=options,"loading"===document.readyState)throw new Error("You need to instantiate Custombox when the document is fully loaded");var selector=document.querySelector(this.options.content.container);if(selector)this.element=selector;else if(document.querySelector("."+CB+"-container"))document.querySelector("."+CB+"-container")&&(this.element=document.querySelector("."+CB+"-container"));else{for(this.element=document.createElement("div");document.body.firstChild;)this.element.appendChild(document.body.firstChild);document.body.appendChild(this.element)}this.element.classList.add(CB+"-container"),this.element.classList.add(CB+"-"+this.options.content.effect),this.element.style.animationDuration=this.options.content.speedIn+"ms",Snippet.check(animationValues,this.options.content.effect)&&this.setAnimation()}return _createClass(Container,[{key:"bind",value:function(method){var _this2=this;return method===CLOSE&&(Snippet.check(animationValues,this.options.content.effect)&&this.setAnimation("animateTo"),this.element.classList.remove(OPEN)),this.element.classList.add(method),new Promise(function(resolve){return _this2.listener().then(function(){return resolve()})})}},{key:"remove",value:function(){this.element.classList.remove(CLOSE),this.element.classList.remove(CB+"-"+this.options.content.effect),this.element.style.removeProperty("animation-duration");var elements=document.querySelectorAll("."+CB+"-content"),container=document.querySelector(this.options.content.container);if(!elements.length)if(container)for(var classes=this.element.className.split(" "),i=0,t=classes.length;i<t;i++)classes[i].startsWith(CB+"-")&&this.element.classList.remove(classes[i]);else{for(var _container=document.querySelector("."+CB+"-container");_container.firstChild;)_container.parentNode.insertBefore(_container.firstChild,_container);_container.parentNode.removeChild(_container)}}},{key:"listener",value:function(){var _this3=this;return new Promise(function(resolve){Snippet.isIE()?setTimeout(resolve,_this3.options.content.speedIn):_this3.element.addEventListener("animationend",function(){return resolve()},!0)})}},{key:"setAnimation",value:function(){for(var action=0<arguments.length&&void 0!==arguments[0]?arguments[0]:FROM,i=0,t=positionValues.length;i<t;i++)this.element.classList.contains(CB+"-"+positionValues[i])&&this.element.classList.remove(CB+"-"+positionValues[i]);this.element.classList.add(CB+"-"+this.options.content[action])}}]),Container}(),Overlay=function(){function Overlay(options){_classCallCheck(this,Overlay),this.options=options,this.element=document.createElement("div"),this.element.style.backgroundColor=this.options.overlay.color,this.options.overlay.zIndex&&(this.element.style.zIndex=this.options.overlay.zIndex.toString()),this.element.classList.add(CB+"-overlay"),this.setAnimation()}return _createClass(Overlay,[{key:"bind",value:function(method){var _this4=this;switch(method){case CLOSE:Snippet.check(overlayValues,this.options.content.effect)&&this.toggleAnimation("animateTo"),this.element.classList.add(CLOSE),this.element.classList.remove(OPEN);break;default:document.body.appendChild(this.element),this.element.classList.add(CB+"-"+this.options.content.effect),this.element.classList.add(OPEN)}return new Promise(function(resolve){return _this4.listener().then(function(){return resolve()})})}},{key:"remove",value:function(){try{this.element.parentNode.removeChild(this.element),this.style.parentNode.removeChild(this.style)}catch(e){}}},{key:"createSheet",value:function(){return this.style=document.createElement("style"),this.style.setAttribute("id",CB+"-overlay-"+Date.now()),document.head.appendChild(this.style),this.style.sheet}},{key:"listener",value:function(){var _this5=this;return new Promise(function(resolve){Snippet.isIE()?setTimeout(resolve,_this5.options.overlay.speedIn):_this5.element.addEventListener("animationend",function(){return resolve()},!0)})}},{key:"setAnimation",value:function(){var sheet=this.createSheet();if(Snippet.check(overlayValues,this.options.content.effect)?(this.element.style.opacity=this.options.overlay.opacity.toString(),this.element.style.animationDuration=this.options.overlay.speedIn+"ms",this.toggleAnimation()):(sheet.insertRule("."+CB+"-overlay { animation: CloseFade "+this.options.overlay.speedOut+"ms; }",0),sheet.insertRule("."+OPEN+"."+CB+"-overlay { animation: OpenFade "+this.options.overlay.speedIn+"ms; opacity: "+this.options.overlay.opacity+" }",0),sheet.insertRule("@keyframes OpenFade { from {opacity: 0} to {opacity: "+this.options.overlay.opacity+"} }",0),sheet.insertRule("@keyframes CloseFade { from {opacity: "+this.options.overlay.opacity+"} to {opacity: 0} }",0)),Snippet.check(together,this.options.content.effect)){var duration=this.options.overlay.speedIn;Snippet.check(together,this.options.content.effect)&&(duration=this.options.content.speedIn),this.element.style.animationDuration=duration+"ms"}}},{key:"toggleAnimation",value:function(){for(var action=0<arguments.length&&void 0!==arguments[0]?arguments[0]:FROM,i=0,t=positionValues.length;i<t;i++)this.element.classList.contains(CB+"-"+positionValues[i])&&this.element.classList.remove(CB+"-"+positionValues[i]);this.element.classList.add(CB+"-"+this.options.content[action])}}]),Overlay}(),Content=function(){function Content(options){if(_classCallCheck(this,Content),this.options=options,this.element=document.createElement("div"),this.element.style.animationDuration=this.options.content.speedIn+"ms",this.options.content.id&&this.element.setAttribute("id",CB+"-"+this.options.content.id),this.options.overlay.zIndex){var z_index=this.options.overlay.zIndex+2;this.element.style.zIndex=z_index.toString()}Snippet.check(together,this.options.content.effect)||(this.element.style.animationDelay=this.options.content.delay+"ms"),this.element.classList.add(CB+"-content"),this.options.content.fullscreen?this.element.classList.add(CB+"-fullscreen"):(this.element.classList.add(CB+"-x-"+this.options.content.positionX),this.element.classList.add(CB+"-y-"+this.options.content.positionY)),Snippet.check(animationValues,this.options.content.effect)&&this.setAnimation()}return _createClass(Content,[{key:"fetch",value:function(){var _this6=this;return new Promise(function(resolve,reject){var match=_this6.options.content.target.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);if(match&&11==match[2].length){var element=document.createElement("div"),frame=document.createElement("iframe");if(frame.setAttribute("src","https://www.youtube.com/embed/"+match[2]),frame.setAttribute("frameborder","0"),frame.setAttribute("allowfullscreen",""),frame.setAttribute("width","100%"),frame.setAttribute("height","100%"),element.appendChild(frame),!_this6.options.content.fullscreen){var w=560<window.innerWidth?560:window.innerWidth,h=315<window.innerHeight?315:window.innerHeight,natural=parseInt(_this6.options.content.width,10);_this6.options.content.width&&window.innerWidth>natural&&(h=Math.round(h*natural/w),w=natural),frame.setAttribute("width",w+"px"),frame.setAttribute("height",h+"px")}_this6.element.appendChild(element),resolve()}else if("#"!==_this6.options.content.target.charAt(0)&&"."!==_this6.options.content.target.charAt(0)){var req=new XMLHttpRequest;req.open("GET",_this6.options.content.target),req.onload=function(){if(200===req.status){_this6.element.insertAdjacentHTML("beforeend",req.response);var child=_this6.element.firstChild;try{child.style.display="block"}catch(e){reject(new Error("The ajax response need a wrapper element"))}_this6.options.content.width&&(child.style.flexBasis=_this6.options.content.width),resolve()}else reject(new Error(req.statusText))},req.onerror=function(){return reject(new Error("Network error"))},req.send()}else{var selector=document.querySelector(_this6.options.content.target);selector?(_this6.options.content.clone?(selector=selector.cloneNode(!0)).removeAttribute("id"):(_this6.reference=document.createElement("div"),_this6.reference.classList.add(CB+"-reference"),_this6.reference.setAttribute("style",selector.getAttribute("style")),selector.parentNode.insertBefore(_this6.reference,selector.nextSibling)),selector.style.display="block",_this6.options.content.width&&(selector.style.flexBasis=_this6.options.content.width),_this6.element.appendChild(selector),resolve()):reject(new Error("The element doesn't exist"))}})}},{key:"bind",value:function(method){var _this7=this;switch(method){case CLOSE:this.element.style.animationDelay="0ms",this.element.style.animationDuration=this.options.content.speedOut+"ms",this.element.classList.remove(OPEN),this.element.classList.add(CLOSE),this.setAnimation("animateTo");break;default:document.body.appendChild(this.element),this.element.classList.add(CB+"-"+this.options.content.effect),this.element.classList.add(OPEN)}return new Promise(function(resolve){return _this7.listener().then(function(){return resolve()})})}},{key:"remove",value:function(){var match=new RegExp("^[#|.]");!this.options.content.clone&&match.test(this.options.content.target)&&(this.element.childNodes[0].setAttribute("style",this.reference.getAttribute("style")),this.reference.parentNode.insertBefore(this.element.childNodes[0],this.reference.nextSibling),this.reference.parentNode.removeChild(this.reference));try{this.element.parentNode.removeChild(this.element)}catch(e){}}},{key:"listener",value:function(){var _this8=this;return new Promise(function(resolve){Snippet.isIE()?setTimeout(resolve,_this8.options.content.speedIn):_this8.element.addEventListener("animationend",function(){return resolve()},!0)})}},{key:"setAnimation",value:function(){for(var action=0<arguments.length&&void 0!==arguments[0]?arguments[0]:FROM,i=0,t=positionValues.length;i<t;i++)this.element.classList.contains(CB+"-"+positionValues[i])&&this.element.classList.remove(CB+"-"+positionValues[i]);this.element.classList.add(CB+"-"+this.options.content[action])}}]),Content}(),modal=function(){function modal(options){_classCallCheck(this,modal),this.action=function(event){27===event.keyCode&&Custombox.modal.close()},this.options=new Options(options)}return _createClass(modal,[{key:"open",value:function(){var _this9=this;this.build(),this.options.loader.active&&this.loader.show(),this.content.fetch().then(function(){Snippet.check(perspective,_this9.options.content.effect)&&(_this9.scroll=new Scroll),_this9.options.overlay.active?(_this9.dispatchEvent("overlay.onOpen"),_this9.overlay.bind(OPEN).then(function(){_this9.dispatchEvent("overlay.onComplete"),_this9.options.loader.active&&_this9.loader.destroy()})):_this9.options.loader.active&&_this9.loader.destroy(),_this9.container&&_this9.container.bind(OPEN),document.body.classList.add(LOCK),_this9.content.bind(OPEN).then(function(){return _this9.dispatchEvent("content.onComplete")}),_this9.dispatchEvent("content.onOpen"),_this9.listeners()}).catch(function(error){throw _this9.options.loader.active&&_this9.loader.destroy(),error})}},{key:"build",value:function(){this.options.loader.active&&(this.loader=new Loader(this.options)),Snippet.check(containerValues,this.options.content.effect)&&(this.container=new Container(this.options)),this.options.overlay.active&&(this.overlay=new Overlay(this.options)),this.content=new Content(this.options)}},{key:"_close",value:function(){var _this10=this,close=[this.content.bind(CLOSE).then(function(){return _this10.content.remove()})];this.options.overlay.active&&close.push(this.overlay.bind(CLOSE).then(function(){_this10.scroll&&_this10.scroll.remove(),_this10.overlay.remove(),_this10.dispatchEvent("overlay.onClose")})),this.container&&close.push(this.container.bind(CLOSE).then(function(){return _this10.container.remove()})),Promise.all(close).then(function(){_this10.options.content.close&&document.removeEventListener("keydown",_this10.action,!0),_this10.dispatchEvent("content.onClose"),document.body.classList.remove(LOCK)})}},{key:"dispatchEvent",value:function(type){var element=type.replace(".on",":").toLowerCase(),event=new CustomEvent(CB+":"+element),action=Object.create(this.options);document.dispatchEvent(event);try{type.split(".").reduce(function(a,b){return a[b]},action).call()}catch(e){}}},{key:"listeners",value:function(){var _this11=this,AFM=window.getComputedStyle(this.content.element).getPropertyValue("animation-fill-mode");document.addEventListener("fullscreenchange",function(){window.getComputedStyle(_this11.content.element).getPropertyValue("animation-fill-mode")===AFM?_this11.content.element.style.animationFillMode="backwards":_this11.content.element.style.animationFillMode=AFM},!0),this.options.content.close&&document.addEventListener("keydown",this.action,!0),this.options.overlay.close&&this.content.element.addEventListener("click",function(event){event.target===_this11.content.element&&_this11._close()},!0),this.content.element.addEventListener(CB+":close",function(){_this11._close()},!0)}}],[{key:"close",value:function(id){var event=new CustomEvent(CB+":close"),elements=document.querySelectorAll("."+CB+"-content");id&&(elements=document.querySelectorAll("#"+CB+"-"+id));try{elements[elements.length-1].dispatchEvent(event)}catch(e){throw new Error("Custombox is not instantiated")}}},{key:"closeAll",value:function(){for(var event=new CustomEvent(CB+":close"),elements=document.querySelectorAll("."+CB+"-content"),t=elements.length,i=0;i<t;i++)elements[i].dispatchEvent(event)}}]),modal}();Custombox.modal=modal}(Custombox||(Custombox={}));